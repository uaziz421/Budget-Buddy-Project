<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accounting Ledger</title>
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }
      .filter-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .filter-input {
        padding: 5px;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <input type="button" value="HELP" style="float: right" />
    <h1>Accounting Ledger</h1>

    <div class="filter-container">
      <div>
        <label for="filter-date">Filter by Date:</label>
        <input type="date" id="filter-date" class="filter-input" />
      </div>
      <div>
        <label for="filter-account">Search by Account Name:</label>
        <input type="text" id="filter-account" class="filter-input" />
        <button onclick="updateLedger()">Search</button>
      </div>
      <div>
        <label for="filter-amount">Search by Amount:</label>
        <input type="number" id="filter-amount" class="filter-input" />
      </div>
      <div>
        <label for="filter-status">Approval Status:</label>
        <select id="filter-status" class="filter-input">
          <option value="">All</option>
          <option value="Pending">Pending</option>
          <option value="Approved">Approved</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Post Ref</th>
          <th>Description</th>
          <th>Debit</th>
          <th>Credit</th>
          <th>Balance</th>
          <th>Approval Status</th>
        </tr>
      </thead>
      <tbody id="ledger-entries">
        <tr></tr>
        <tr onclick="goToChartOfAccounts()">
          <td>JE-001</td>
        </tr>
      </tbody>
    </table>

    <script>
		
		window.onload = GetAccountNumFromURL();
		
		function GetAccountNumFromURL() {
			const queryString = window.location.search;
			const urlParams = new URLSearchParams(queryString);
			const accountNumber = urlParams.get('acctNum');
		}
		
      const ledgerEntries = [
        {
          date: "2024-04-01",
          postRef: "JE-001",
          description: "",
          debit: 1000,
          credit: 0,
          balance: 1000,
        },
        { 
          date: "2024-02-21",
          postRef: "DE-214",
          description: "",
          debit: 0,
          credit: 4000,
          balance: 4000,
        }
      ];


      const tbody = document.getElementById("ledger-entries");

      function updateLedger() {
        tbody.innerHTML = ""; // Clear existing entries

        let filteredEntries = ledgerEntries.slice();

        // Filter by date
        const filterDate = document.getElementById("filter-date").value;
        if (filterDate) {
          filteredEntries = filteredEntries.filter(
            (entry) => entry.date === filterDate
          );
        }

        // Filter by account name
        const filterAccount = document
          .getElementById("filter-account")
          .value.toLowerCase();
        if (filterAccount) {
          filteredEntries = filteredEntries.filter((entry) =>
            entry.postRef.toLowerCase().includes(filterAccount)
          );
        }

        // Filter by amount
        const filterAmount = document.getElementById("filter-amount").value;
        if (filterAmount) {
          const amount = parseFloat(filterAmount);
          filteredEntries = filteredEntries.filter(
            (entry) => Math.abs(entry.debit - entry.credit) === amount
          );
        }

        let runningBalance = 0;
        for (const entry of filteredEntries) {
          const tableRow = document.createElement("tr");

          const dateCell = document.createElement("td");
          dateCell.textContent = entry.date;
          tableRow.appendChild(dateCell);
          // postref link to the journal entry that created the account
          const postRefCell = document.createElement("td");
          const postRefLink = document.createElement("a");
          postRefLink.href = `/Managers/viewApprovedJournalEntries.html?postRef=${entry.postRef}`;
          postRefLink.textContent = entry.postRef;
          postRefCell.appendChild(postRefLink);
          tableRow.appendChild(postRefCell);

          const descriptionCell = document.createElement("td");
          descriptionCell.textContent = entry.description;
          tableRow.appendChild(descriptionCell);

          const debitCell = document.createElement("td");
          debitCell.textContent = entry.debit ? entry.debit.toFixed(2) : "";
          tableRow.appendChild(debitCell);

          const creditCell = document.createElement("td");
          creditCell.textContent = entry.credit ? entry.credit.toFixed(2) : "";
          tableRow.appendChild(creditCell);

          // Calculate and display running balance
          runningBalance += entry.debit - entry.credit;
          const balanceCell = document.createElement("td");
          balanceCell.textContent = runningBalance.toFixed(2);
          tableRow.appendChild(balanceCell);

          tbody.appendChild(tableRow);
        }
      }

      // Call updateLedger initially to display data
      updateLedger();

      for (const entry of filteredEntries) {
        const tableRow = document.createElement("tr");

        // ... create and populate table cells ...

        // Add click event listener to the table row
        tableRow.addEventListener("click", goToChartOfAccounts);

        // ... other table cells ...

        tbody.appendChild(tableRow);
      }

      function goToChartOfAccounts() {
        // Reload chartOfAccounts.html within the current window
        window.location.href = "chartOfAccounts.html";
      }
    </script>
  </body>
</html>
