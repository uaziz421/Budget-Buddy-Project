<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accounting Ledger</title>
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }
      .filter-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .filter-input {
        padding: 5px;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <input type="button" value="HELP" style="float: right" />
    <h1>Accounting Ledger</h1>

    <div class="filter-container">
      <div>
        <label for="filter-date">Filter by Date:</label>
        <input type="date" id="filter-date" class="filter-input" />
      </div>
      <div>
        <label for="filter-account">Search by Account Name:</label>
        <input type="text" id="filter-account" class="filter-input" />
        <button onclick="updateLedger()">Search</button>
      </div>
      <div>
        <label for="filter-amount">Search by Amount:</label>
        <input type="number" id="filter-amount" class="filter-input" />
      </div>
      <div>
        <label for="filter-status">Approval Status:</label>
        <select id="filter-status" class="filter-input">
          <option value="">All</option>
          <option value="Pending">Pending</option>
          <option value="Approved">Approved</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Post Ref</th>
          <th>Description</th>
          <th>Debit</th>
          <th>Credit</th>
          <th>Balance</th>
          <th>Approval Status</th>
        </tr>
      </thead>
      <tbody id="entriesFromJournal">
        <tr></tr>
        <tr onclick="goToChartOfAccounts()">
          <td>JE-001</td>
        </tr>
      </tbody>
    </table>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        ref,
        onValue,
        getDatabase,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA3C8jafXUUD2s--XEzzfJfVybXs0ZBJyo",
        authDomain: "budget-buddy-65565.firebaseapp.com",
        projectId: "budget-buddy-65565",
        storageBucket: "budget-buddy-65565.appspot.com",
        messagingSenderId: "416172669900",
        appId: "1:416172669900:web:49618f6822c7d660f5fb69",
        measurementId: "G-W4MRFFH4JV",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      window.onload = () => {
        GetJournalEntries();
      };

      function BalanceCalculation(deb, cred) {
        const creditAmount = parseFloat(cred) || 0;
        const debitAmount = parseFloat(deb) || 0;

        return (debitAmount - creditAmount).toFixed(2);
      }

      function GetJournalEntries() {
        const journalref = ref(db, "journalEntries");
        onValue(
          journalref,
          (snapshot) => {
            const tableBody = document.getElementById("entriesFromJournal");
            const journalentries = snapshot.val();
            tableBody.innerHTML = "";

            if (journalentries) {
              Object.keys(journalentries).forEach((data) => {
                const tableRow = document.createElement("tr");
                const journalentry = journalentries[data];

                tableRow.innerHTML = `
                    <td>${journalentry.date || ""}</td>
                    <td>${journalentry.postRef || ""}</td>
                    <td>${journalentry.description || ""}</td>
                    <td>${
                      journalentry.debit
                        ? parseFloat(journalentry.debit).toFixed(2)
                        : "0"
                    }</td>
                    <td>${
                      journalentry.credit
                        ? parseFloat(journalentry.credit).toFixed(2)
                        : "0"
                    }</td>
                    <td>${BalanceCalculation(
                      journalentry.debit,
                      journalentry.credit
                    )}</td>
                    <td>${journalentry.approvalStatus || "Pending"}</td>
                `;
                tableBody.appendChild(tableRow);
              });
            } else {
              alert("There are no journal entries found.");
            }
          },
          (err) => {
            console.error(err);
          }
        );
      }
    </script>
  </body>
</html>
