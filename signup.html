<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>CreateUser</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <div style="text-align: center">
      <img width="300" src="Logos/Logo1.jpeg" alt="Logo1" />
    </div>
    <div class="subheader-container">
      <h2 id="subheaderh2">
        Welcome to Budget Buddy, your favorite accounting web application.
      </h2>
    </div>
    <div class="signup-container">
      <h3 id="subheaderh3">Sign up for Budget Buddy</h3>
      <br />
      <div class="signup-form">
        <label>First Name:</label>
        <input type="text" name="First Name" id="firstName" />

        <label>Last Name:</label>
        <input type="text" name="Last Name" id="lastName" />

        <label>Date of Birth</label>
        <input type="date" name="Date of Birth" id="dob" />

        <label>Street Address:</label>
        <input type="text" name="Street Address" id="streetAddress" />

        <label>City:</label>
        <input type="text" name="City" id="city" />

        <label>State:</label>
        <select name="State" id="state">
          <option value="AL">Alabama</option>
          <option value="AK">Alaska</option>
          <option value="AZ">Arizona</option>
          <option value="AR">Arkansas</option>
          <option value="CA">California</option>
          <option value="CO">Colorado</option>
          <option value="CT">Connecticut</option>
          <option value="DE">Delaware</option>
          <option value="DC">District Of Columbia</option>
          <option value="FL">Florida</option>
          <option value="GA">Georgia</option>
          <option value="HI">Hawaii</option>
          <option value="ID">Idaho</option>
          <option value="IL">Illinois</option>
          <option value="IN">Indiana</option>
          <option value="IA">Iowa</option>
          <option value="KS">Kansas</option>
          <option value="KY">Kentucky</option>
          <option value="LA">Louisiana</option>
          <option value="ME">Maine</option>
          <option value="MD">Maryland</option>
          <option value="MA">Massachusetts</option>
          <option value="MI">Michigan</option>
          <option value="MN">Minnesota</option>
          <option value="MS">Mississippi</option>
          <option value="MO">Missouri</option>
          <option value="MT">Montana</option>
          <option value="NE">Nebraska</option>
          <option value="NV">Nevada</option>
          <option value="NH">New Hampshire</option>
          <option value="NJ">New Jersey</option>
          <option value="NM">New Mexico</option>
          <option value="NY">New York</option>
          <option value="NC">North Carolina</option>
          <option value="ND">North Dakota</option>
          <option value="OH">Ohio</option>
          <option value="OK">Oklahoma</option>
          <option value="OR">Oregon</option>
          <option value="PA">Pennsylvania</option>
          <option value="RI">Rhode Island</option>
          <option value="SC">South Carolina</option>
          <option value="SD">South Dakota</option>
          <option value="TN">Tennessee</option>
          <option value="TX">Texas</option>
          <option value="UT">Utah</option>
          <option value="VT">Vermont</option>
          <option value="VA">Virginia</option>
          <option value="WA">Washington</option>
          <option value="WV">West Virginia</option>
          <option value="WI">Wisconsin</option>
          <option value="WY">Wyoming</option>
        </select>

        <label>Zip Code:</label>
        <input type="text" name="Zip Code" id="zip" />

        <label>Email Address:</label>
        <input type="email" name="Email Address" id="signupEmail" />

        <label>Username:</label>
        <input type="text" name="Username" id="userName" />

        <label>Password:</label>
        <input type="password" name="Password" id="password" />

        <label>Desired Role:</label>
        <select name="Role" id="role">
          <option value="Administrator">Administrator</option>
          <option value="Manager">Manager</option>
          <option value="User">User</option>
        </select>
        <br /><br />

        <input type="submit" name="signup" id="signup" value="Sign Up" />
      </div>
    </div>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";

      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBymv-Dhd-LEPYuqN87keTOngySucUkjSQ",
        authDomain: "budget-buddy-4b61a.firebaseapp.com",
        databaseURL: "https://budget-buddy-4b61a-default-rtdb.firebaseio.com",
        projectId: "budget-buddy-4b61a",
        storageBucket: "budget-buddy-4b61a.appspot.com",
        messagingSenderId: "188748354368",
        appId: "1:188748354368:web:92d47eb0b171ea6f77e0a5",
        measurementId: "G-B81WY7GQTG",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      import {
        getDatabase,
        set,
        get,
        update,
        remove,
        ref,
        child,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

      const db = getDatabase();

      var firstName = document.querySelector("#firstName");
      var lastName = document.querySelector("#lastName");
      var streetAddress = document.querySelector("#streetAddress");
      var city = document.querySelector("#city");
      var state = document.querySelector("#state");
      var zip = document.querySelector("#zip");
      var dob = document.querySelector("#dob");
      var signupEmail = document.querySelector("#signupEmail");
      var userName = document.querySelector("#userName");
      var password = document.querySelector("#password");
      var role = document.querySelector("#role");

      function SignUp() {
        set(ref(db, "People/" + userName.value), {
          FirstName: firstName.value,
          LastName: lastName.value,
          StreetAddress: streetAddress.value,
          City: city.value,
          State: state.value,
          ZipCode: zip.value,
          DOB: dob.value,
          Email: signupEmail.value,
          Username: userName.value,
          Password: password.value,
          Role: role.value,
        })
          .then(() => {
            alert(
              "User information submitted. Please wait for an email from the administrator before attempting to log in."
            );
            window.location.replace("index.html");
          })
          .catch((error) => {
            alert(error);
          });

        var templateParams = {
          from_name: "Sender",
          firstName: firstName.value,
          lastName: lastName.value,
          userName: userName.value,
        };

        emailjs
          .send("service_psxifkt", "template_eqvppz5", templateParams)
          .then(
            function (response) {
              console.log("SUCCESS!", response.status, response.text);
            },
            function (error) {
              console.log("FAILED...", error);
            }
          );
      }

      signup.addEventListener("click", SignUp);
    </script>

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
    ></script>
    <script type="text/javascript">
      (function (SendEmail) {
        emailjs.init("fw5Rt0t2jdkj4iyKi");
      })();
    </script>
  </body>
</html>
