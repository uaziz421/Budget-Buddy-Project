<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Chart Of Accounts</title>
<link href="style.css" rel="stylesheet" type="text/css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
    .labs{
        display: inline-block;
        width: 100px;
    }

    #createJournalEntry {
      margin-bottom: 20px;
    }

    #journalTable th {
      padding: 10px;
    }

    #journalTable td {
      padding: 10px;
    }

</style>
</head>
 
<body>
	<header>
	<!-- This code displays logo, username -->
		<a href="dashboard.html"><img src="Logos/Logo1.jpeg" alt="Logo1" width="150" align="right"></a>
		<h3 id="displayName" type="text" align="left"></h3>
		<h3 id="displayUsername" type="text" align="left"></h3>
		<input type="date" id="showCal" align="left">
  	</header>
	
    <div class="container">
      <h>Search: </h>
      <input type="text" id="myInput" onkeyup="search_table()" placeholder="Filter Any Column" title="Type in a name">
        <br><br><br><br>
		<h2>Asset Accounts</h2>
		<table class="table table-striped">
          <thead>
              <th>Account Number</th>
			  <th>Account Name</th>
              <th>To Increase</th>
			  <th>Account Description</th>
          </thead>
          <tbody id="assetAccounts">
			  <tr></tr>
          </tbody>
      </table>
    </div>

 
	<div class="container">
      <h>Search: </h>
      <input type="text" id="myInput" onkeyup="search_table()" placeholder="Filter Any Column" title="Type in a name">
        <br><br><br><br>
		<h2>Liability Accounts</h2>
		<table class="table table-striped">
          <thead>
              <th>Account Number</th>
			  <th>Account Name</th>
              <th>To Increase</th>
			  <th>Account Description</th>
          </thead>
          <tbody id="liabilityAccounts">
			  <tr></tr>
          </tbody>
      </table>
    </div>
	
	
	<div class="container">
      <h>Search: </h>
      <input type="text" id="myInput" onkeyup="search_table()" placeholder="Filter Any Column" title="Type in a name">
        <br><br><br><br>
		<h2>Equity Accounts</h2>
		<table class="table table-striped">
          <thead>
              <th>Account Number</th>
			  <th>Account Name</th>
              <th>To Increase</th>
			  <th>Account Description</th>
          </thead>
          <tbody id="equityAccounts">
			  <tr></tr>
          </tbody>
      </table>
    </div>
	
	
	<div class="container">
      <h>Search: </h>
      <input type="text" id="myInput" onkeyup="search_table()" placeholder="Filter Any Column" title="Type in a name">
        <br><br><br><br>
		<h2>Revenue Accounts</h2>
		<table class="table table-striped">
          <thead>
              <th>Account Number</th>
			  <th>Account Name</th>
              <th>To Increase</th>
			  <th>Account Description</th>
          </thead>
          <tbody id="revenueAccounts">
			  <tr></tr>
          </tbody>
      </table>
    </div>
	
	
	<div class="container">
      <h>Search: </h>
      <input type="text" id="myInput" onkeyup="search_table()" placeholder="Filter Any Column" title="Type in a name">
        <br><br><br><br>
		<h2>Expense Accounts</h2>
		<table class="table table-striped">
          <thead>
              <th>Account Number</th>
			  <th>Account Name</th>
              <th>To Increase</th>
			  <th>Account Description</th>
          </thead>
          <tbody id="expenseAccounts">
			  <tr></tr>
          </tbody>
      </table>
    </div>
	
	
<!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">Control Panel</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <label class="labs">Account Name: </label>>
          <input type="text" id="NameMod"> <br>
          <label class="labs">Account Number: </label>>
          <input type="text" id="NameMod"> <br>
          <label class="labs">Account Description: </label>>
          <input type="text" id="NameMod"> <br>
          <label class="labs">Normal Side: </label>>
          <input type="text" id="NameMod"> <br>
        </div>
        <div class="modal-footer">
          <button id="AddModBtn" type="button" class="btn btn-primary" onclick="AddStd()">Add New Record</button>
          <button id="UpdateModBtn" type="button" class="btn btn-success" onclick="UpdStd()">Update Record</button>
          <button id="DelModBtn" type="button" class="btn btn-danger" onclick="DelStd()">Delete Record</button>
        </div>
      </div>
    </div>
  </div>

  <button id="createJournalEntry">Create Journal Entry</button>
  <button id="approveJournalEntry">Approve Entry</button>
  <button id="rejectJournalEntry">Reject Entry</button>
  <br>
  <a href="administrator/email_accountant.html">
    <button id ="adminButton">Contact User</button>
  </a>

  <div id="journalTable"></div>
 
 
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
	import { getDatabase, set, get, update, remove, ref, child, onValue} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
	import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
	import { serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
	

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyA3C8jafXUUD2s--XEzzfJfVybXs0ZBJyo",
  authDomain: "budget-buddy-65565.firebaseapp.com",
  projectId: "budget-buddy-65565",
  storageBucket: "budget-buddy-65565.appspot.com",
  messagingSenderId: "416172669900",
  appId: "1:416172669900:web:49618f6822c7d660f5fb69",
  measurementId: "G-W4MRFFH4JV"
};
	
	
// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	const db = getDatabase();
	const dbref = ref(db);
	const auth = getAuth();
	const user = auth.currentUser;
	
    var accountNumber;
	var accountName;
	var normalSide;
	var accountDesc;
	
	window.onload = GetAccounts();

	function GetAccounts() {
		const dbref = ref(db);
		const dbrefAccounts = ref(db, 'Accounts/');
		
		//This portion of code iterates through the Accounts database to get the required information
		onValue(dbrefAccounts, (snapshot) => {
			snapshot.forEach((childSnapshot) => {
				accountNumber = childSnapshot.val().AccountNumber;
				accountName = childSnapshot.val().AccountName;
				normalSide = childSnapshot.val().NormalSide;
				accountDesc = childSnapshot.val().AccountDesc;
				if(accountNumber.charAt(0)==1) {
					AddItemsToAssetTable();
				}
				if(accountNumber.charAt(0)==2) {
					AddItemsToLiabilityTable();
				}	
				if(accountNumber.charAt(0)==3) {
					AddItemsToEquityTable();
				}	
				if(accountNumber.charAt(0)==4) {
					AddItemsToRevenueTable();
				}	
				if(accountNumber.charAt(0)==5) {
					AddItemsToExpenseTable();
				}	
			})
		})
	}
	
	//This function appends the data retrieved from the AcctEdits database to the table
	function AddItemsToAssetTable() {
		var tbody = document.getElementById("assetAccounts");
		var trow = document.createElement("tr");
		var td1 = document.createElement("td");
		var td2 = document.createElement("td");
		var td3 = document.createElement("td");
		var td4 = document.createElement("td");
		td1.innerHTML = accountNumber;
		td2.innerHTML = accountName;
		td3.innerHTML = normalSide;
		td4.innerHTML = accountDesc;
		trow.appendChild(td1); 
		trow.appendChild(td2); 
		trow.appendChild(td3); 
		trow.appendChild(td4); 
		tbody.appendChild(trow);
	}
	
	function AddItemsToLiabilityTable() {
		var tbody = document.getElementById("liabilityAccounts");
		var trow = document.createElement("tr");
		var td1 = document.createElement("td");
		var td2 = document.createElement("td");
		var td3 = document.createElement("td");
		var td4 = document.createElement("td");
		td1.innerHTML = accountNumber;
		td2.innerHTML = accountName;
		td3.innerHTML = normalSide;
		td4.innerHTML = accountDesc;
		trow.appendChild(td1); 
		trow.appendChild(td2); 
		trow.appendChild(td3); 
		trow.appendChild(td4); 
		tbody.appendChild(trow);
	}
	
	function AddItemsToEquityTable() {
		var tbody = document.getElementById("equityAccounts");
		var trow = document.createElement("tr");
		var td1 = document.createElement("td");
		var td2 = document.createElement("td");
		var td3 = document.createElement("td");
		var td4 = document.createElement("td");
		td1.innerHTML = accountNumber;
		td2.innerHTML = accountName;
		td3.innerHTML = normalSide;
		td4.innerHTML = accountDesc;
		trow.appendChild(td1); 
		trow.appendChild(td2); 
		trow.appendChild(td3); 
		trow.appendChild(td4); 
		tbody.appendChild(trow);
	}
	
	function AddItemsToRevenueTable() {
		var tbody = document.getElementById("revenueAccounts");
		var trow = document.createElement("tr");
		var td1 = document.createElement("td");
		var td2 = document.createElement("td");
		var td3 = document.createElement("td");
		var td4 = document.createElement("td");
		td1.innerHTML = accountNumber;
		td2.innerHTML = accountName;
		td3.innerHTML = normalSide;
		td4.innerHTML = accountDesc;
		trow.appendChild(td1); 
		trow.appendChild(td2); 
		trow.appendChild(td3); 
		trow.appendChild(td4); 
		tbody.appendChild(trow);
	}
	
	function AddItemsToExpenseTable() {
		var tbody = document.getElementById("expenseAccounts");
		var trow = document.createElement("tr");
		var td1 = document.createElement("td");
		var td2 = document.createElement("td");
		var td3 = document.createElement("td");
		var td4 = document.createElement("td");
		td1.innerHTML = accountNumber;
		td2.innerHTML = accountName;
		td3.innerHTML = normalSide;
		td4.innerHTML = accountDesc;
		trow.appendChild(td1); 
		trow.appendChild(td2); 
		trow.appendChild(td3); 
		trow.appendChild(td4); 
		tbody.appendChild(trow);
	}
	
	
	//Displays current user username and photo
	setTimeout(function(){
        const user = auth.currentUser;
		const dbref = ref(db);
		
		get(child(dbref, "People/" + user.displayName))
		.then((snapshot)=>{
			if(snapshot.exists()) {
				displayName.innerHTML = snapshot.val().FirstName + " " + snapshot.val().LastName; //get current user first and last name
				displayUsername.innerHTML = snapshot.val().Username;
			}
		})
		.catch((error)=>{
			alert(error)
		})
   	},250); //delay is in milliseconds; delay needed to load page then display name.
</script>
</body>
</html>